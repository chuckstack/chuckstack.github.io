<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Conventions</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ul class="chapter">
                    <li><a class="active" href="../">chuck-stack Home</a></li>
                </ul>
                <ol class="chapter"><li class="chapter-item expanded "><a href="introduction.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="picture-success.html"><strong aria-hidden="true">2.</strong> Picture of Success</a></li><li class="chapter-item expanded "><a href="getting-started.html"><strong aria-hidden="true">3.</strong> Getting Started</a></li><li class="chapter-item expanded "><a href="stack-faq.html"><strong aria-hidden="true">4.</strong> Stack FAQ</a></li><li class="chapter-item expanded "><a href="stack-tools.html"><strong aria-hidden="true">5.</strong> Stack Tools</a></li><li class="chapter-item expanded "><a href="best-practices.html"><strong aria-hidden="true">6.</strong> Best Practices</a></li><li class="chapter-item expanded "><a href="stack-application.html"><strong aria-hidden="true">7.</strong> Stack Application</a></li><li class="chapter-item expanded "><a href="stack-academy.html"><strong aria-hidden="true">8.</strong> Stack Academy</a></li><li class="chapter-item expanded "><a href="postgres-conventions.html" class="active"><strong aria-hidden="true">9.</strong> Conventions</a></li><li class="chapter-item expanded "><a href="terminology.html"><strong aria-hidden="true">10.</strong> Terminology</a></li><li class="chapter-item expanded "><a href="roadmap.html"><strong aria-hidden="true">11.</strong> Roadmap</a></li><li class="chapter-item expanded "><a href="project-history.html"><strong aria-hidden="true">12.</strong> Project History</a></li><li class="chapter-item expanded affix "><li class="spacer"></li><li class="chapter-item expanded "><a href="code-of-conduct.html"><strong aria-hidden="true">13.</strong> Code of Conduct</a></li><li class="chapter-item expanded "><a href="privacy-policy.html"><strong aria-hidden="true">14.</strong> Privacy Policy</a></li><li class="chapter-item expanded affix "><li class="spacer"></li><li class="chapter-item expanded "><a href="blog.html"><strong aria-hidden="true">15.</strong> Blog</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="blog-work-instruction-sexy.html"><strong aria-hidden="true">15.1.</strong> Work Instructions Make your Organization Sexy</a></li><li class="chapter-item expanded "><a href="blog-live-markdown-world.html"><strong aria-hidden="true">15.2.</strong> We Live in a Markdown World</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <!-- add things here that will go above the body navigation -->
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="postgresql-conventions"><a class="header" href="#postgresql-conventions">PostgreSQL Conventions</a></h1>
<p>The purpose of this page is to describe the concepts and methodologies for creating PostgreSQL designs. Consistent use of conventions create clarity. Here are the values that drive our conventions:</p>
<!-- TODO: these bullets need improvement -->
<ul>
<li>Consistency for clarity</li>
<li>Purpose driven</li>
<li>Reduce development time</li>
<li>Reduce development environment complexity</li>
<li>Reduce learning time</li>
<li>Reduce complexity</li>
<li>Maximize use of conventions</li>
<li>Minimize the number of expertise needed to articulate a design</li>
</ul>
<h2 id="schema"><a class="header" href="#schema">Schema</a></h2>
<p>We use multiple PostgreSQL schemas to create a expose our application logic to the rest of the system.</p>
<h3 id="private-schema"><a class="header" href="#private-schema">Private Schema</a></h3>
<p>We start with a private schema where we define our data model. It is labelled <code>private</code> as a convention because no outside system should interact with this internal schema directly. Said another way, the private schema is used to insulate internal details from the outside world.</p>
<h3 id="public-schemas"><a class="header" href="#public-schemas">Public Schemas</a></h3>
<p>We create at least one public schema. The purpose of the public schemas are to expose a semantically controlled interface. More on <a href="https://en.wikipedia.org/wiki/Software_versioning">semantic versioning</a>. It is possible to maintain multiple public schemas simultaneously in situations where you need two or more major versions versions available at the same time.</p>
<p>If you support a single exposed schema, you can name the publicly available schema something like <code>public</code> or <code>api</code>. If you plan to support multiple schemas simultaneously, you can include the major version number in the schema name like <code>public_v1</code> or <code>public_v2</code>. It is not common to support multiple versions at the same time; however, it does happen.</p>
<p>The separation between private and public schemas allows you to change the private data and logic representations while publicly maintaining semantic version control.</p>
<p>The artifacts in a public schema will most commonly begin as simple pass-through views and functions. Minor and patch releases will most likely introduce more complexity the public schema. Major releases might give you an opportunity to simply the public schema since you can introduce breaking changes to the public api.</p>
<h2 id="table-conventions"><a class="header" href="#table-conventions">Table Conventions</a></h2>
<p>This section discuss how we create tables in the private schema.</p>
<ul>
<li>Tables use a uuid column as the primary key. The purpose of this decision is to make creating very large (and often replicated) systems easier to manage. Doing so also allows for clients to define their own uuid values and removes a potential centralized process.</li>
<li>All tables have a single primary key (even if it is a link table). The purpose of this decision is to enable the concept of table_name + record_uu unique record identification. Said another way, if you know the table_name and the record_uu of any given record, you can always find the details associated with that record. This convention also allows us to create many features that are shared across all records in all tables. These features include centralized logs, attachments, and attributes.</li>
<li>All core chuck-stack tables will begin with <code>stack_</code>. Example: <code>stack_business_partner</code>.</li>
<li>Your organization should chose a table prefix that resembles your organization's name if you wish to add new tables or new columns. Example: the Good-Care Medical organization could have a prefix of <code>gcm_</code>.</li>
<li>Link tables should have a table name suffix of <code>_link</code>. <!-- TODO: add link table to definitions --></li>
<li>Tables should have comments that describe the purpose of the table. Because AI is so proficient at understanding SQL DDL, we can define both how the table operates and why it exists in the same location. Because SQL is self describing, we can query table comments to obtain help documentation is not extra effort.</li>
</ul>
<h2 id="column-conventions"><a class="header" href="#column-conventions">Column Conventions</a></h2>
<ul>
<li>Primary uuid key (<code>_uu</code> suffix) - All tables have a single primary key per the above discussion.</li>
<li>Foreign keys end with a <code>_uu</code> suffix. Example <code>stack_some_other_table_uu</code>. There are times when this convention is not possible due to multiple references to the same table. What a duplicate is needed, add an adjective before the <code>_uu</code> suffix. Examples: <code>stack_business_partner_ship_to_uu</code> and <code>stack_business_partner_bill_to_uu</code>.</li>
<li>When naming columns the noun comes first and the adjective comes next. Example: stack_wf_state_next_uu where state is the noun and next is the adjective. The benefit of this approach is that like columns (and the resulting methods/calls) appear next to each other alphabetically. <!-- TODO: create a list of abbreviations like wf, asi, etc... --></li>
<li>Use columns of type text (instead of varchar with unspecified length). Only choose a varchar with a specific length when there is a compelling reason to do so. Even then try not to...</li>
<li>Boolean values must have a default value defined at the table level.</li>
<li>Consider using the column's description/comment to hold column_label and column_description
<ul>
<li>comment on column wf_process.name is '{"column_label": "Name", "column_description": "Name describing the record"}';</li>
<li>select pg_catalog.col_description(c.oid, col.ordinal_position::int)::json-&gt;&gt;'column_label' ...</li>
<li>see sql/readme.md for more details</li>
</ul>
</li>
</ul>
<h2 id="table-standard-column"><a class="header" href="#table-standard-column">Table Standard Column</a></h2>
<p>This sections lists the mandatory and optional columns found in chuck-stack tables. Notice that coding and naming by convention plays a role in primary key name and foreign key relationships. As you will see below, you know the primary key column name as a function of the table name. You know the foreign key table name as a function of the foreign key column name.</p>
<h3 id="mandatory-columns"><a class="header" href="#mandatory-columns">Mandatory Columns</a></h3>
<ul>
<li>primary key - The primary key column bears the name of the table with a <code>_uu</code> suffix. Example: <code>stack_some_table_uu</code></li>
<li><code>stack_tenant_uu</code> - foreign key reference to the tenant that owns the record <!-- TODO: define tenant and add link here --></li>
<li><code>stack_org_uu</code> - financial set of books that owns the record <!-- TODO: define org and add link here --></li>
<li><code>created</code> - timestamp indicating when the record was created.</li>
<li><code>created_by_uu</code> - uuid foreign key reference to the database user/role that created the record.</li>
<li><code>updated</code> - timestamp indicating when the record was last updated.</li>
<li><code>updated_by_uu</code> - uuid foreign key reference to the database user/role that last updated the record.</li>
</ul>
<h3 id="optional-columns"><a class="header" href="#optional-columns">Optional Columns</a></h3>
<ul>
<li><code>is_active</code> - boolean that indicates if a record can be modified. is_active also acts as a soft-delete. If a record has an is_active=false, the record should be be returned as an option for selection in future lists and drop down fields. This column must be present to update it after the initial save; therefore, it appears in most tables.</li>
<li><code>name</code> - text column representing the name of the record.</li>
<li><code>description</code> - text column representing the description of the record.</li>
<li><code>search_key</code> - user defined text column. The purpose of this column is to allow users to create keys that are more easily remembered by humans. It is up to the implementor to determine if the search_key should be unique for any given table. If it should be unique, the implementor determines the unique criteria. search_key columns are most appropriate for tables that maintain a primary concept but the record is not considered transactional. Examples of non-transactional records include users, business partners, and products.</li>
<li><code>value</code> - text column that is often used along with a <code>search_key</code> in a key-value pair.</li>
<li><code>document_no</code> - user defined text column. The purpose of this column is to allow the system to auto-populate auto-incrementing document numbers. It is up to the implementor to determine if the document_no should be unique. If it should be unique, the implementor determines the unique criteria. The document_no column is most appropriate for tables that represent transactional data. Examples of a transaction records include invoices, orders, and payments. Tables that have a search_key column will not have a document_no column. The opposite is also true. <!-- TODO: define and link implementor --></li>
<li><code>is_default</code> - boolean that indicates if a record should represent a default option. Typically, only one records can have is_default=true; however, there are circumstances where multiple records in the same table can have is_default=true based on unique record attributes. Implementors chose the unique criteria for any given table with a is_default column.</li>
<li><code>is_processed</code> - boolean that indicates of a record has reached its final state. Said another way, if a record's is_processed=true, then no part of the record should updated or deleted. TODO: we need a way to prevent children of processed records to also be assumed to be processed unless the record has its own is_processed column.</li>
<li><code>is_template</code> boolean that indicates if a record exists for the purpose of cloning to create new records.</li>
</ul>
<h2 id="function-conventions"><a class="header" href="#function-conventions">Function Conventions</a></h2>
<ul>
<li>concept of function =&gt; create_from vs create_into -- attempt to support both when possible <!-- TODO: better define these terms --></li>
</ul>
<h2 id="sample-table"><a class="header" href="#sample-table">Sample Table</a></h2>
<pre><code class="language-sql">CREATE TABLE stack_some_table (
  stack_some_table_uu UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  created TIMESTAMP NOT NULL DEFAULT now(),
  created_by_uu uuid NOT NULL,
  updated TIMESTAMP NOT NULL DEFAULT now(),
  updated_by_uu uuid NOT NULL,
  search_key TEXT NOT NULL,
  value TEXT NOT NULL,
  name TEXT NOT NULL,
  description TEXT,
  is_default BOOLEAN DEFAULT false,
  is_processed BOOLEAN DEFAULT false,
  is_active BOOLEAN DEFAULT true,
  CONSTRAINT fk_some_table_created_by FOREIGN KEY (created_by_uu) REFERENCES stack_user(stack_user_uu),
  CONSTRAINT fk_some_table_updated_by FOREIGN KEY (updated_by_uu) REFERENCES stack_user(stack_user_uu)
);
COMMENT ON TABLE stack_some_table IS 'Table that contains some data';
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="stack-academy.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="terminology.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="stack-academy.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="terminology.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <!-- Livereload script (if served using the cli tool) -->
        <script>
            const wsProtocol = location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsAddress = wsProtocol + "//" + location.host + "/" + "__livereload";
            const socket = new WebSocket(wsAddress);
            socket.onmessage = function (event) {
                if (event.data === "reload") {
                    socket.close();
                    location.reload();
                }
            };

            window.onbeforeunload = function() {
                socket.close();
            }
        </script>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
